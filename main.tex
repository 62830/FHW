\documentclass[12pt]{article}

%--------------------------------------------------

\RequirePackage{fontspec}
\RequirePackage{xeCJK}
\XeTeXlinebreaklocale "zh"
\XeTeXlinebreakskip = 0pt plus 1pt

\setmainfont{GenYoMinTW-R}
\setsansfont{GenYoGothicTW-R}
\setmonofont{NotoSansMono-Regular}

\setCJKmainfont{NotoSerifCJKtc-Regular}
\setCJKsansfont{NotoSansCJKtc-Regular}
\setCJKmonofont{NotoSansMonoCJKtc-Regular}

\RequirePackage[onehalfspacing]{setspace}

%--------------------------------------------------

\RequirePackage{amssymb}
\RequirePackage{amsmath}
\RequirePackage{yhmath}
\RequirePackage{mathtools}
\RequirePackage{esint} % for \oiint
\RequirePackage{halloweenmath}
\RequirePackage{siunitx} % for \unit
\RequirePackage{mleftright}
\mleftright

\makeatletter
\newcommand{\@renewmid}{\renewcommand{\mid}{%
		\mathclose{}%
		\mathchoice{\;}{\;}{\,}{\,}%
		\delimsize\vert%\allowbreak
		\mathchoice{\;}{\;}{\,}{\,}%
		\mathopen{}%
}}
% tex.stackexchange.com/a/43009
\DeclarePairedDelimiter{\@abs}{\lvert}{\rvert}
\DeclarePairedDelimiter{\@ceil}{\lceil}{\rceil}
\DeclarePairedDelimiter{\@floor}{\lfloor}{\rfloor}
\DeclarePairedDelimiter{\@angle}{\langle}{\rangle}
\DeclarePairedDelimiter{\@norm}{\lVert}{\rVert}
\DeclarePairedDelimiterX{\@set}[1]{\{}{\}}{\@renewmid#1}
\DeclarePairedDelimiterX{\@Set}[1]{\{}{\}}{\@renewmid\nonscript\,#1\nonscript\,} % \nonscript suppresses \, in (script)script style

\def\abs{\@ifstar{\@abs}{\@abs*}}
\def\ceil{\@ifstar{\@ceil}{\@ceil*}}
\def\floor{\@ifstar{\@floor}{\@floor*}}
\def\inner{\@ifstar{\@inner}{\@inner*}} \def\norm{\@ifstar{\@norm}{\@norm*}}
\def\set{\@ifstar{\@set}{\@set*}}
\def\Set{\@ifstar{\@Set}{\@Set*}}
\makeatother

\mathcode`\*="8000
{\catcode`\*\active\gdef*{\cdot}}

\newcommand{\N}{\mathbb N}
\newcommand{\Z}{\mathbb Z}
\newcommand{\Q}{\mathbb Q}
\newcommand{\R}{\mathbb R}
\newcommand{\C}{\mathbb C}
\newcommand{\contra}{\rightarrow\!\leftarrow}

%--------------------------------------------------

\RequirePackage{xcolor}
\definecolor{nord00}{HTML}{2e3440}
\definecolor{nord01}{HTML}{3b4252}
\definecolor{nord02}{HTML}{434c5e}
\definecolor{nord03}{HTML}{4c566a}
\definecolor{nord04}{HTML}{d8dee9}
\definecolor{nord05}{HTML}{e5e9f0}
\definecolor{nord06}{HTML}{eceff4}
\definecolor{nord07}{HTML}{8fbcbb}
\definecolor{nord08}{HTML}{88c0d0}
\definecolor{nord09}{HTML}{81a1c1}
\definecolor{nord10}{HTML}{5e81ac}
\definecolor{nord11}{HTML}{bf616a}
\definecolor{nord12}{HTML}{d08770}
\definecolor{nord13}{HTML}{ebcb8b}
\definecolor{nord14}{HTML}{a3be8c}
\definecolor{nord15}{HTML}{b48ead}
\definecolor{My0}{HTML}{021D5F}
\definecolor{My1}{HTML}{283C7E}
\definecolor{My2}{HTML}{4E5B9C}
\definecolor{My3}{HTML}{747ABB}
\definecolor{My4}{HTML}{9A98D9}

%--------------------------------------------------

\RequirePackage{geometry}
\geometry{
	% showframe,
	a4paper,
	ignorefoot,
	ignorehead,
	hmargin=2cm,
	vmargin=2cm,
	headsep=5mm,
	footskip=2\baselineskip,
	footnotesep=8mm,
}
\RequirePackage[parfill]{parskip}
% \RequirePackage{microtype}

%--------------------------------------------------

\RequirePackage{titlesec}               % 設定 section 等的字體
\RequirePackage{titling}                % 加強 title 功能
\RequirePackage{fancyhdr}               % 頁首頁尾
\makeatletter %\@title only usable after this
\setlength{\headwidth}{\paperwidth-\Gm@lmargin-\Gm@rmargin}
\pagestyle{fancy}
\fancyhf{}
\lhead{\@CourseName\;|\;\@title}
\rhead{\@ID\;\@author}
\cfoot{\thepage}
\makeatother

%--------------------------------------------------

\RequirePackage{tikz}
\RequirePackage{tikzpagenodes}
\usetikzlibrary{calc}

\makeatletter
\newcommand{\DeclareVariable}[1]{
	\expandafter\DeclareRobustCommand\csname#1\endcsname[1]{
		\expandafter\gdef\csname @#1\endcsname{##1}
	}
}
\DeclareVariable{CourseID}
\DeclareVariable{CourseName}
\DeclareVariable{ID}

\newcommand{\HeaderFillSize}{5cm}
\def\@maketitle{%
	\newpage%
	\begingroup%
	\begin{tikzpicture}[ remember picture, overlay ]%
		\fill[%
			shading = axis,rectangle, top color=My0, bottom color=My0!30!My4,%
			] (current page.north west) rectangle ($(current page.north east) + (0, -\HeaderFillSize)$);%
		\coordinate (BottomLeft) at ($(current page text area.north west) + (0, -3cm)$);
		\node[%
			anchor=north west,%
			font=\LARGE\rmfamily\bfseries,%
			text=white,%
			] (title) at ([yshift=1cm+\baselineskip]BottomLeft) {\@CourseName\;|\;\@title};%
		\node[%
			anchor=north west,%
			font=\rmfamily\scshape,%
			text=white,%
			] (courseID) at ([yshift=\baselineskip]title.north west) {\@CourseID};
		\node[%
			anchor=north east,%
			font=\rmfamily\large,%
			minimum height=\baselineskip,%
			text=white,%
			] (author) at ([xshift=\textwidth,yshift=\HeaderFillSize+\topmargin]BottomLeft) {\@ID\;\@author};%
		\node[%
			anchor=north east,%
			font=\rmfamily\large,%
			minimum height=\baselineskip,%
			text=white,%
			] (date) at ([yshift=-1.5\baselineskip]author.north east) {\number\year/\number\month/\number\day};%
	\end{tikzpicture}%
	\vspace{3cm}%
	\endgroup%
}
\makeatother

%--------------------------------------------------

\RequirePackage{xurl}
\RequirePackage{hyperref}
\RequirePackage[capitalize,nameinlink,noabbrev]{cleveref}

\hypersetup{
	urlbordercolor=black,
	linkbordercolor=black,
  pdfborderstyle={/S/U/W 0.5}
}

%--------------------------------------------------

\RequirePackage{amsthm}

\newcommand*{\NewTheorem}[1]{
	\expandafter\providecommand\csname#1autorefname\endcsname{\MakeUppercase#1}
	\crefname{#1}{ {\MakeUppercase#1} }{{\MakeUppercase#1}s}
	\newtheorem{#1}{\MakeUppercase#1}
	\newtheorem*{#1*}{\MakeUppercase#1}
}

\newtheoremstyle{myStyle}{}{}{\hangindent=1.5em}{\parindent}{\bfseries}{}{.8em}{%
	\thmname{#1}%
	\thmnumber{ #2.}%
	\thmnote{ \bfseries{(#3)}}%
}
\theoremstyle{myStyle}

\NewTheorem{corollary}
\NewTheorem{lemma}
\NewTheorem{observation}
\NewTheorem{theorem}

%--------------------------------------------------

\RequirePackage[newfloat]{minted}
\RequirePackage{caption}
\RequirePackage{algorithm}              % for psuedo code
\RequirePackage{algpseudocode}
\RequirePackage{mdframed}

\mdfdefinestyle{CodeBlock}{
	innerleftmargin=28pt,
	innerbottommargin=0pt,
	hidealllines=true,
}

\usemintedstyle{nord}

\renewcommand{\theFancyVerbLine}{
	\textcolor{nord01}{\footnotesize\arabic{FancyVerbLine}}
}

\newenvironment{code}{\captionsetup{type=listing}}{}
\SetupFloatingEnvironment{listing}{name=Code}
\crefname{listing}{Code}{Codes}

\newcommand{\Code}[5][]{
	\begin{code}
		\begin{spacing}{1}
			\begin{mdframed}[style=CodeBlock]
				\parskip=0pt
				\inputminted[
				bgcolor=nord01,
				% frame=leftline,
				tabsize=2,
				obeytabs,
				linenos,
				mathescape,
				fontsize=\footnotesize,
				numbersep=0pt,
				#1
				]{#2}{#3}
			\end{mdframed}
			\caption{#4}
			\label{code:#5}
		\end{spacing}
	\end{code}
}

%--------------------------------------------------

\RequirePackage{graphicx}

\newcommand{\Image}[3]{
	\begin{figure}[htpb]
		\centering
		\includegraphics[width=0.8\textwidth]{#1}
		\caption{#2}
		\label{img:#3}
	\end{figure}
}

%--------------------------------------------------

\makeatletter
\newcounter{problem}
\providecommand{\problemname}{Problem}

\let\problemmark\@gobble
\let\toclevel@problem\toclevel@section % for PDF bookmarks

% disables numbering for problems, for both actual headers and in TOC
\def\l@problem#1#2{\begingroup\let\numberline\@gobble\l@section{#1}{#2}\endgroup} % tex.stackexchange.com/a/62117
\def\@nonumsproblem{}
\def\@seccntformat#1{% www.texfaq.org/FAQ-seccntfmt
	\ifcsname @nonums#1\endcsname\else
		\csname the#1\endcsname\quad% default behavior for other section types, from ltsect.dtx
	\fi
}

\newcommand{\@problemsection}{
\@startsection{problem}{2}{-.5ex}%\z@}
	{-3.25ex\@plus -1ex \@minus -.2ex}
	{1.5ex \@plus .2ex}
	{\normalfont\large\bfseries}
}

\newcommand*{\@problem}[1][\@nil]{% tex.stackexchange.com/a/217763
	\def\@arg{#1}
	\begingroup\edef\x{\endgroup% expands problem counter for \nameref: tex.stackexchange.com/a/569405
		\noexpand\@problemsection{
			\problemname{} % note: space
			\ifx\@arg\@nnil\the\numexpr\value{problem}+1\else#1\fi%
		}
	}\x
}
\newcommand{\problem}{\@ifstar{
		\@problem
	}{
		\ifnum\theproblem>0\newpage\fi
		\@problem
}}
\makeatother

%--------------------------------------------------

\RequirePackage{enumerate}
\renewcommand\labelitemi{\raisebox{.2ex}{$\bullet$}}
\RequirePackage{ulem}
\RequirePackage{enumerate}
\RequirePackage{tabularx}
\RequirePackage{siunitx}
\RequirePackage{ytableau}
\RequirePackage{halloweenmath}

%--------------------------------------------------

\RequirePackage{blindtext}

\title{Beautiful Homework}
\author{Author}
\ID{b11902000}
\CourseID{Math4007-01}
\CourseName{Calculus 2}

\begin{document}

\maketitle

\blindtext
\Code[firstline=2]{cpp}{a.cpp}{caption}{label}
\blindtext
\Image{cactus.jpeg}{Cactus!}{cactus}

\section{Lorem}

Zisk \footnote{Known as ZCKevin} is strong. \cref{code:label} and \cref{img:cactus}.

\subsection {Chinese lorem}

\sout{顏色}香半，褕海知，舉臥之斯文大⋯萬里送，Lorem ipsum dol'or sit amet, consectetuer adipiscing elit. 幾度九華帳山色之難難，楚能余亦之難難夜日行陽為君。萬事仙臥月南風何十怨遙夜⋯風沙，師落葉滿秋，歲閣自照露，征柳啾啾月一曲然不得有殷勤，遠不到酒稀清輝。腸何時還，行路難獨夜南⋯羅微鳳路雪虛征戰。鳴看煙，衣裳多斜馬，相見秋松下孤城君不見西羽歲王孫：見臨烽火桃李但見茫茫獨，問見得城月涕淚長可聖兒夢不成，掩至今歌。雖識月明如此，曲夢在新到天秋一，寂昔不逢闌干，窗東流水腸斷角不見清天與故人，下兒雨千門微遲里劍閣白，石鼓。


Some words imediatly after code block\ldots

$$
\abs{1 + \frac xy}^2
$$

\[
	\abs{\frac{1}{1 - \lambda h}} \le 1
	\qquad\text{and}\qquad
	\bigcup_{i=1}^n \; \set{z \in \C \mid \abs*{z - a_{ii}} \le {\sum\nolimits_{j \ne i}} \abs*{a_{ij}}}.
\]

\blindtext

\newpage

\section{Ipsum}
\blindtext

沒有好棒，別嗚哈哈哈，都這個實說不然也不，的人的什麼最好。經不院可以去為什麼有，沒該會人嗎亡如果是，再次存跟我試圖，只有直接說這是放到最近的的影片⋯陌生人⋯也知道個月的。其覺得是起來跟不可能也很，畫面待喔好天的簡單很不是聽起來，然已經就聖我的話的聲。再然後道了嗎傍晚時害的，男的話就需要一，或許是的男，去的方法我愛次自行要跟⋯了沒好會的角色這邊，一把的人會出們看記⋯

\problem*
\problem*
\problem*
\section{test}
\problem*
\blindtext
\problem*[8]
\subsection{test}
\problem*

\begin{theorem}
	Theorem 1. \blindtext
\end{theorem}

\begin{lemma}
	Lemma 1.
\end{lemma}

\begin{observation}
	My observation.
	\label{myob}
\end{observation}

\begin{lemma}[My lemma]
	My lemma.
	According to \cref{myob}.
\end{lemma}

\begin{theorem}[My theorem]
	Another theorem
\end{theorem}

\begin{lemma}
	Lemma 2.
\end{lemma}

Teeeeest url: \url{https://tex.stackexchange.com/questions/61015/how-to-use-different-colors-for-different-href-commands}
\href{https://en.wikibooks.org/wiki/LaTeX/Counters}{Test hrefy}

\end{document}
